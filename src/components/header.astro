---
import { getTranslations, type Locale } from '../i18n/translations';
import { getCurrentLocale, getLocalizedPath, getAlternateLocales } from '../i18n/utils';

interface Props {
  locale?: Locale;
}

const locale = Astro.props.locale || getCurrentLocale(Astro.url);
const t = getTranslations(locale);
const currentPath = Astro.url.pathname;

// Función para determinar si una ruta es la activa
const isActive = (path: string) => {
    const normalizedPath = path === '/' ? '/' : getLocalizedPath(path, locale);
    if (normalizedPath === '/' && currentPath === '/') return true;
    if (normalizedPath !== '/' && currentPath.startsWith(normalizedPath)) return true;
    return false;
}

// Generar clases para los enlaces basadas en si están activos o no
const getLinkClasses = (path: string) => {
    const baseClasses = "text-sm font-semibold";
    const activeClasses = "text-orange-500 dark:text-orange-400 border-b-2 border-orange-500 dark:border-orange-400";
    const inactiveClasses = "text-gray-800 dark:text-gray-200 hover:text-orange-800 dark:hover:text-orange-400 hover:border-b-0";
    
    return `${baseClasses} ${isActive(path) ? activeClasses : inactiveClasses}`;
}

const getLocalizedHref = (path: string) => {
  return getLocalizedPath(path, locale);
}
---

<header role="banner" class="bg-[var(--bg-primary)] transition-colors duration-300">
    <nav class="flex items-center justify-between p-4 shadow-sm border-b border-[var(--border-color)] bg-[var(--bg-primary)] transition-colors duration-300" role="navigation" aria-label={t.nav.skipToContent}>
        <div>
            <a 
                class="text-sm gap-4 font-semibold hover:text-gray-950 dark:hover:text-gray-100 text-gray-800 dark:text-gray-200 flex items-center focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 rounded" 
                href={getLocalizedHref('/')}
                aria-label="HTML Preview Editor - {t.nav.home}"
            >
                <svg class="w-5 h-6 text-orange-500" viewBox="0 0 896 1024" aria-hidden="true" focusable="false"><path fill="currentColor" d="M831.405 1024h-767q-27 0-45.5-18.5T.405 960V65q0-27 18.5-45.5T64.405 1h448v352q0 13 9 22.5t23 9.5h351v575q0 27-18.5 45.5t-45.5 18.5m-459-440q12-12 12-30t-12-30.5t-29-12.5t-29 13l-175 149q-12 13-12 30.5t12 30.5l175 149q12 13 29 13t29-12.5t12-30.5t-12-30l-146-119zm384 89l-174-149q-12-13-29-13t-29 12.5t-12 30.5t12 30l145 120l-145 119q-12 12-12 30t12 30.5t29 12.5t29-13l174-149q13-13 13-30.5t-13-30.5m-180-673q26 0 44 18l256 257q19 19 19 46h-319z"/></svg>
                <span>HTML preview</span>
            </a>
        </div>
        <div class="flex items-center gap-4">
          <ul class="flex items-center gap-4" role="menubar">
              <li role="none">
                  <a 
                      class={getLinkClasses('/')} 
                      href={getLocalizedHref('/')}
                      role="menuitem"
                      aria-current={isActive('/') ? 'page' : undefined}
                  >
                      {t.nav.home}
                  </a>
              </li>
              <li role="none">
                  <a 
                      class={getLinkClasses('/about')} 
                      href={getLocalizedHref('/about')}
                      role="menuitem"
                      aria-current={isActive('/about') ? 'page' : undefined}
                  >
                      {t.nav.about}
                  </a>
              </li>
          </ul>
          <button
            id="theme-toggle"
            class="p-2 rounded-lg text-gray-800 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition-colors"
            aria-label="Toggle dark mode"
            title="Toggle dark mode"
          >
            <svg id="theme-icon-light" class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
            </svg>
            <svg id="theme-icon-dark" class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
            </svg>
          </button>
          <div class="relative" role="group" aria-label={t.lang.select}>
            <label for="language-selector" class="sr-only">{t.lang.select}</label>
            <select 
              id="language-selector"
              class="text-sm font-semibold text-gray-800 dark:text-gray-200 bg-transparent border border-gray-300 dark:border-gray-600 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 cursor-pointer"
              aria-label={t.lang.select}
            >
              <option value={getLocalizedHref(currentPath)} selected>{locale.toUpperCase()}</option>
              {getAlternateLocales(locale, currentPath).map(({ locale: altLocale, url }) => (
                <option value={url}>{altLocale.toUpperCase()}</option>
              ))}
            </select>
          </div>
          <script>
            document.getElementById('language-selector')?.addEventListener('change', function(e) {
              const target = e.target as HTMLSelectElement;
              if (target.value) {
                window.location.href = target.value;
              }
            });
          </script>
        </div>
    </nav>
</header>