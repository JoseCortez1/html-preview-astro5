---
import { getTranslations, type Locale } from '../i18n/translations';
import { getCurrentLocale, getLocalizedPath, getAlternateLocales } from '../i18n/utils';

interface Props {
  locale?: Locale;
}

const locale = Astro.props.locale || getCurrentLocale(Astro.url);
const t = getTranslations(locale);
const currentPath = Astro.url.pathname;

// Función para determinar si una ruta es la activa
const isActive = (path: string) => {
    const normalizedPath = path === '/' ? '/' : getLocalizedPath(path, locale);
    if (normalizedPath === '/' && currentPath === '/') return true;
    if (normalizedPath !== '/' && currentPath.startsWith(normalizedPath)) return true;
    return false;
}

// Determinar clases para cada enlace
const homeIsActive = isActive('/');
const aboutIsActive = isActive('/about');

const getLocalizedHref = (path: string) => {
  return getLocalizedPath(path, locale);
}
---

<header role="banner" class="bg-[var(--bg-primary)] transition-colors duration-300">
    <nav class="flex items-center justify-between p-4 shadow-sm border-b border-[var(--border-color)] bg-[var(--bg-primary)] transition-colors duration-300" role="navigation" aria-label={t.nav.skipToContent}>
        <div>
            <a 
                class="text-sm gap-4 font-semibold hover:!text-orange-600 dark:hover:text-gray-100 !text-gray-900 dark:!text-gray-200 flex items-center focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 rounded transition-colors" 
                href={getLocalizedHref('/')}
                aria-label="HTML Preview Editor - {t.nav.home}"
            >
                <svg class="w-5 h-6 !text-orange-600 dark:!text-orange-400" viewBox="0 0 896 1024" aria-hidden="true" focusable="false"><path fill="currentColor" d="M831.405 1024h-767q-27 0-45.5-18.5T.405 960V65q0-27 18.5-45.5T64.405 1h448v352q0 13 9 22.5t23 9.5h351v575q0 27-18.5 45.5t-45.5 18.5m-459-440q12-12 12-30t-12-30.5t-29-12.5t-29 13l-175 149q-12 13-12 30.5t12 30.5l175 149q12 13 29 13t29-12.5t12-30.5t-12-30l-146-119zm384 89l-174-149q-12-13-29-13t-29 12.5t-12 30.5t12 30l145 120l-145 119q-12 12-12 30t12 30.5t29 12.5t29-13l174-149q13-13 13-30.5t-13-30.5m-180-673q26 0 44 18l256 257q19 19 19 46h-319z"/></svg>
                <span>HTML preview</span>
            </a>
        </div>
        <div class="flex items-center gap-4">
          <ul class="flex items-center gap-4" role="menubar">
              <li role="none">
                  <a 
                      class={`text-sm font-semibold transition-colors ${
                        homeIsActive 
                          ? 'text-orange-600 dark:text-orange-400 border-b-2 border-orange-600 dark:border-orange-400' 
                          : 'text-gray-900 dark:text-gray-200 hover:text-orange-600 dark:hover:text-orange-400 hover:border-b-0'
                      }`}
                      href={getLocalizedHref('/')}
                      role="menuitem"
                      aria-current={homeIsActive ? 'page' : undefined}
                  >
                      {t.nav.home}
                  </a>
              </li>
              <li role="none">
                  <a 
                      class={`text-sm font-semibold transition-colors ${
                        aboutIsActive 
                          ? 'text-orange-600 dark:text-orange-400 border-b-2 border-orange-600 dark:border-orange-400' 
                          : 'text-gray-900 dark:text-gray-200 hover:text-orange-600 dark:hover:text-orange-400 hover:border-b-0'
                      }`}
                      href={getLocalizedHref('/about')}
                      role="menuitem"
                      aria-current={aboutIsActive ? 'page' : undefined}
                  >
                      {t.nav.about}
                  </a>
              </li>
          </ul>
          <button
            id="theme-toggle"
            class="p-2 rounded-lg !text-gray-900 dark:!text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 transition-colors"
            aria-label="Toggle dark mode"
            title="Toggle dark mode"
          >
            <svg id="theme-icon-light" class="w-5 h-5 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
            </svg>
            <svg id="theme-icon-dark" class="w-5 h-5 block dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
            </svg>
          </button>
          <div class="relative" role="group" aria-label={t.lang.select}>
            <label for="language-selector" class="sr-only">{t.lang.select}</label>
            <select 
              id="language-selector"
              class="text-sm font-semibold !text-gray-900 dark:!text-gray-200 bg-transparent border border-gray-400 dark:border-gray-600 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-2 cursor-pointer transition-colors"
              aria-label={t.lang.select}
            >
              <option value={getLocalizedHref(currentPath)} selected>{locale.toUpperCase()}</option>
              {getAlternateLocales(locale, currentPath).map(({ locale: altLocale, url }) => (
                <option value={url}>{altLocale.toUpperCase()}</option>
              ))}
            </select>
          </div>
          <script>
            document.getElementById('language-selector')?.addEventListener('change', function(e) {
              const target = e.target as HTMLSelectElement;
              if (target.value) {
                window.location.href = target.value;
              }
            });
          </script>
        </div>
    </nav>
</header>

<style>
  /* Forzar colores oscuros en light mode para textos del navbar */
  html[data-theme="light"] header nav a,
  html[data-theme="light"] header nav button,
  html[data-theme="light"] header nav select,
  html[data-theme="light"] header nav span {
    color: #111827 !important;
    filter: none !important;
    opacity: 1 !important;
  }
  
  /* Asegurar que no haya overlays o elementos superpuestos */
  html[data-theme="light"] header nav a::before,
  html[data-theme="light"] header nav a::after {
    display: none !important;
  }
  
  /* Colores naranjas para iconos y enlaces activos en light mode */
  html[data-theme="light"] header nav a[class*="text-orange"],
  html[data-theme="light"] header nav svg[class*="text-orange"],
  html[data-theme="light"] header nav a.text-orange-600,
  html[data-theme="light"] header nav svg.text-orange-600 {
    color: #ea580c !important;
  }
  
  html[data-theme="light"] header nav a:hover[class*="text-orange"],
  html[data-theme="light"] header nav a:hover.text-orange-600 {
    color: #c2410c !important;
  }
  
  /* Enlaces del menú (ul li a) en light mode - mayor especificidad */
  html[data-theme="light"] header nav ul a,
  html[data-theme="light"] header nav ul li a {
    color: #111827 !important;
    filter: none !important;
    opacity: 1 !important;
  }
  
  /* Enlaces activos del menú en light mode - mayor especificidad */
  html[data-theme="light"] header nav ul a[class*="border-orange"],
  html[data-theme="light"] header nav ul li a[class*="border-orange"],
  html[data-theme="light"] header nav ul a[class*="text-orange"],
  html[data-theme="light"] header nav ul li a[class*="text-orange"] {
    color: #ea580c !important;
    filter: none !important;
    opacity: 1 !important;
  }
  
  /* Sobrescribir cualquier clase dark: en los enlaces del menú */
  html[data-theme="light"] header nav ul a[class*="dark:"],
  html[data-theme="light"] header nav ul li a[class*="dark:"] {
    color: #111827 !important;
  }
  
  html[data-theme="light"] header nav ul a[class*="border-orange"][class*="dark:"] {
    color: #ea580c !important;
  }
  
  /* Iconos SVG del botón de tema en light mode */
  html[data-theme="light"] header nav button svg {
    color: #111827 !important;
  }
  
  /* Iconos SVG con fill="currentColor" en light mode */
  html[data-theme="light"] header nav svg[fill="currentColor"],
  html[data-theme="light"] header nav svg path[fill="currentColor"] {
    fill: currentColor !important;
  }
  
  /* Asegurar que los SVG hereden el color del padre en light mode */
  html[data-theme="light"] header nav a svg,
  html[data-theme="light"] header nav svg {
    color: inherit !important;
    filter: none !important;
    opacity: 1 !important;
  }
  
  /* Icono del logo específicamente en light mode */
  html[data-theme="light"] header nav > div:first-child a svg {
    color: #ea580c !important;
    fill: #ea580c !important;
  }
  
  /* Texto del logo en light mode */
  html[data-theme="light"] header nav > div:first-child a span {
    color: #111827 !important;
  }
  
  /* Dark mode - mantener colores claros */
  html[data-theme="dark"] header nav a,
  html[data-theme="dark"] header nav button,
  html[data-theme="dark"] header nav select,
  html[data-theme="dark"] header nav span,
  html.dark header nav a,
  html.dark header nav button,
  html.dark header nav select,
  html.dark header nav span {
    color: #e5e7eb !important;
  }
  
  html[data-theme="dark"] header nav a[class*="text-orange"],
  html[data-theme="dark"] header nav svg[class*="text-orange"],
  html.dark header nav a.text-orange-400,
  html.dark header nav svg.text-orange-400 {
    color: #ff8904 !important;
  }
  
  /* Iconos SVG del botón de tema en dark mode */
  html[data-theme="dark"] header nav button svg,
  html.dark header nav button svg {
    color: #e5e7eb !important;
  }
  
  /* Iconos SVG con fill="currentColor" en dark mode */
  html[data-theme="dark"] header nav svg[fill="currentColor"],
  html[data-theme="dark"] header nav svg path[fill="currentColor"],
  html.dark header nav svg[fill="currentColor"],
  html.dark header nav svg path[fill="currentColor"] {
    fill: currentColor !important;
  }
  
  /* Asegurar que los SVG hereden el color del padre en dark mode */
  html[data-theme="dark"] header nav a svg,
  html[data-theme="dark"] header nav svg,
  html.dark header nav a svg,
  html.dark header nav svg {
    color: inherit !important;
  }
</style>